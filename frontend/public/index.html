<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <title>Wheel Strategy Tracker</title>
    <style>
        * { margin: 0; padding: 0; box-sizing: border-box; }
        body {
            min-height: 100vh;
            background: linear-gradient(135deg, #1a1a2e 0%, #16213e 100%);
            font-family: 'Segoe UI', sans-serif;
            color: #ffffff;
            padding: 40px 20px;
        }
        h2 { text-align: center; margin: 30px 0 20px; color: #4ecca3; font-weight: 300; }
        .table-container {
            width: 100%; max-width: 1400px;
            margin: 0 auto 50px auto;
            background: rgba(255, 255, 255, 0.05);
            backdrop-filter: blur(10px);
            border-radius: 12px;
            overflow: hidden;
            box-shadow: 0 10px 30px rgba(0,0,0,0.5);
        }
        table { width: 100%; border-collapse: collapse; text-align: left; }
        th { background-color: #4ecca3; color: #1a1a2e; padding: 15px; text-transform: uppercase; font-size: 0.75rem; letter-spacing: 1px; }
        td { padding: 15px; border-bottom: 1px solid rgba(255, 255, 255, 0.1); font-size: 0.9rem; }
        .text-green { color: #2ecc71; font-weight: bold; }
        .text-red { color: #e74c3c; font-weight: bold; }
        .row-active { background: rgba(78, 204, 163, 0.12); border-left: 4px solid #4ecca3; }
        .asset-details { font-size: 0.8rem; color: #a0a0a0; }
    </style>
</head>
<body>
    <h1 style="text-align:center">Wheel Strategy Tracker version 1.0</h1>
    
    <h2>List of Wheels</h2>
    <div id="wheel-summary-box" class="table-container"></div>

    <h2>Complete Trade History</h2>
    <div id="data-box" class="table-container"></div>

    <script>
        async function fetchAllData() {
            try {
                // 1. Fetch and Render Wheel Summary
                const summaryResp = await fetch('http://127.0.0.1:8000/wheel-summary');
                const summaryData = await summaryResp.json();
                
                let sHtml = `<table><thead><tr><th>#</th><th>Symbol</th><th>Strike</th><th>Start</th><th>End</th><th>Comms</th><th>Net Result</th><th>Status</th></tr></thead><tbody>`;
                summaryData.forEach(w => {
                    // Access .value for display strings and .raw for logic
                    sHtml += `<tr class="${w.isOpen ? 'row-active' : ''}">
                        <td>${w.wheelNum}</td>
                        <td><strong>${w.symbol}</strong></td>
                        <td>${w.strike}</td>
                        <td>${w.startDate}</td>
                        <td>${w.isOpen ? '—' : w.endDate}</td>
                        <td class="text-red">${w.comm.value}</td>
                        <td class="${w.pnl.class}">${w.pnl.value}</td>
                        <td>${w.isOpen ? 'ACTIVE' : 'CLOSED'}</td>
                    </tr>`;
                });
                document.getElementById('wheel-summary-box').innerHTML = sHtml + `</tbody></table>`;

                // 2. Fetch and Render Complete History
                const historyResp = await fetch('http://127.0.0.1:8000/history');
                const historyData = await historyResp.json();
                
                let hHtml = `<table><thead><tr><th>Date</th><th>Symbol</th><th>Details</th><th>Qty</th><th>Price</th><th>Comm</th></tr></thead><tbody>`;
                historyData.forEach(item => {
                    // Item.price is already a string "$0.00" or float based on your backend formatting
                    hHtml += `<tr>
                        <td>${item.date}</td>
                        <td><strong>${item.symbol}</strong></td>
                        <td class="asset-details">${item.details}</td>
                        <td class="${item.qty < 0 ? 'text-red' : 'text-green'}">${item.qty}</td>
                        <td>${item.price}</td>
                        <td class="text-red">${item.comm.raw !== 0 ? item.comm.value : '—'}</td>
                    </tr>`;
                });
                document.getElementById('data-box').innerHTML = hHtml + `</tbody></table>`;

            } catch (e) { 
                console.error("API Error:", e);
                document.getElementById('wheel-summary-box').innerHTML = `<p style="padding:20px; color:red;">Failed to connect to backend. Is it running?</p>`;
            }
        }
        fetchAllData();
    </script>
</body>
</html>